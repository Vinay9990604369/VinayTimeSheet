{% extends "base.html" %}
{% load static %}

{% block content %}
<h2>Timesheet Entry</h2>

<!-- Filters on top -->
<form method="get" action="{% url 'timesheet_entry' %}" style="margin-bottom: 1rem;">
  <label for="client">Client:</label>
  <select id="client" name="client" required>
    <option value="">-- Select Client --</option>
    {% for client in clients %}
      <option value="{{ client.id }}" {% if client.id|stringformat:"s" == selected_client_id %}selected{% endif %}>
        {{ client.company_name }}
      </option>
    {% endfor %}
  </select>

  <label for="project">Project:</label>
  <select id="project" name="project" required>
    <option value="">-- Select Project --</option>
    {% for project in projects %}
      <option value="{{ project.id }}" {% if project.id|stringformat:"s" == selected_project_id %}selected{% endif %}>
        {{ project.project_name }}
      </option>
    {% endfor %}
  </select>

  <label for="month">Month:</label>
  <input type="month" id="month" name="month" value="{{ selected_month }}" required />

  <button type="submit">Load Timesheet</button>
</form>

{% if timesheet_entries %}
<form method="post" novalidate>
  {% csrf_token %}
  <table border="1" cellpadding="5" cellspacing="0" style="width:100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th>Date</th>
        <th>Client</th>
        <th>Client ID</th>
        <th>Project</th>
        <th>Project ID</th>
        <th>Service Provider</th>
        <th>Service Type</th>
        <th>Phase</th>
        <th>Billing Consultant</th>
        <th>Last Updated</th>
        <th>Billing Time Duration (hrs)</th>
        <th>Work Description</th>
        <th>Comments</th>
      </tr>
    </thead>
    <tbody>
      {% for entry in timesheet_entries %}
        <tr>
          <td>{{ entry.date_of_service|date:"Y-m-d" }}</td>
          <td><input type="text" value="{{ entry.client.company_name }}" readonly></td>
          <td><input type="text" value="{{ entry.client.client_id }}" readonly></td>
          <td><input type="text" value="{{ entry.project.project_name }}" readonly></td>
          <td><input type="text" value="{{ entry.project.project_id }}" readonly></td>
          <td><input type="text" value="{{ entry.service_provider }}" readonly></td>
          <td><input type="text" value="{{ entry.service_type }}" readonly></td>
          <td><input type="text" value="{{ entry.phase }}" readonly></td>
          <td><input type="text" value="{{ entry.billing_consultant.username }}" readonly></td>
          <td><input type="text" value="{{ entry.last_updated|date:"Y-m-d H:i" }}" readonly></td>

          <td>
            <input 
              type="number" 
              step="0.1" min="0" max="24"
              name="duration_{{ entry.id }}" 
              value="{{ entry.duration|default_if_none:'' }}" 
              required
            >
          </td>
          <td>
            <textarea 
              name="description_{{ entry.id }}" 
              rows="2" 
              cols="30" 
              required
            >{{ entry.description }}</textarea>
          </td>
          <td>
            <textarea 
              name="remarks_{{ entry.id }}" 
              rows="2" 
              cols="30"
            >{{ entry.remarks }}</textarea>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <button type="submit" style="margin-top: 1rem;">Save All Entries</button>
</form>
{% else %}
  <p>Please select client, project and month and click "Load Timesheet" to see entries.</p>
{% endif %}

{% endblock %}
